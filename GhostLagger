-- GHOST LAG V1 - ABSOLUTE FINAL PERFECT VERSION --
-- Key → ḠhồṧẗḸấḡ (copy-paste exactly)

local Players = game:GetService("Players")
local Player = Players.LocalPlayer
local VirtualInputManager = game:GetService("VirtualInputManager")
local CoreGui = game:GetService("CoreGui")

local correctKey = "ḠhồṧẗḸấḡ"
local unlocked = false
local fired = false
local minimized = false

-- Main GUI
local gui = Instance.new("ScreenGui", CoreGui)
gui.ResetOnSpawn = false

local main = Instance.new("Frame", gui)
main.Size = UDim2.new(0, 380, 0, 210)
main.Position = UDim2.new(0.5, -190, 0.5, -105)
main.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
main.ClipsDescendants = true
main.Active = true
main.Draggable = true

Instance.new("UICorner", main).CornerRadius = UDim.new(0, 16)
Instance.new("UIStroke", main).Color = Color3.fromRGB(60, 60, 80)
Instance.new("UIStroke", main).Thickness = 1.5

-- Top bar
local topBar = Instance.new("Frame", main)
topBar.Size = UDim2.new(1, 0, 0, 40)
topBar.BackgroundColor3 = Color3.fromRGB(18, 18, 22)
topBar.ZIndex = 10
Instance.new("UICorner", topBar).CornerRadius = UDim.new(0, 16)

-- Title
local title = Instance.new("TextLabel", topBar)
title.Size = UDim2.new(1, -100, 1, 0)
title.BackgroundTransparency = 1
title.Text = "Ghost Lag V1"
title.TextColor3 = Color3.fromRGB(220, 220, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextXAlignment = Enum.TextXAlignment.Left
title.Position = UDim2.new(0, 16, 0, 0)

-- Buttons
local mini = Instance.new("TextButton", topBar)
mini.Size = UDim2.new(0, 36, 0, 36)
mini.Position = UDim2.new(1, -84, 0, 2)
mini.BackgroundTransparency = 1
mini.Text = "−"
mini.TextColor3 = Color3.fromRGB(200, 200, 255)
mini.Font = Enum.Font.GothamBold
mini.TextSize = 28

local close = Instance.new("TextButton", topBar)
close.Size = UDim2.new(0, 36, 0, 36)
close.Position = UDim2.new(1, -44, 0, 2)
close.BackgroundTransparency = 1
close.Text = "X"
close.TextColor3 = Color3.fromRGB(255, 100, 100)
close.Font = Enum.Font.GothamBold
close.TextSize = 20
close.MouseButton1Click:Connect(function() gui:Destroy() end)

-- Content
local content = Instance.new("Frame", main)
content.Size = UDim2.new(1, 0, 1, -40)
content.Position = UDim2.new(0, 0, 0, 40)
content.BackgroundTransparency = 1

-- Textbox (moved up a bit — less gap from top bar)
local inputFrame = Instance.new("Frame", content)
inputFrame.Size = UDim2.new(0, 340, 0, 60)
inputFrame.Position = UDim2.new(0.5, -170, 0, 22)   -- ← reduced from 30 → 22
inputFrame.BackgroundColor3 = Color3.fromRGB(28, 28, 35)
Instance.new("UICorner", inputFrame).CornerRadius = UDim.new(0, 12)

local placeholder = Instance.new("TextLabel", inputFrame)
placeholder.Size = UDim2.new(1, 0, 1, 0)
placeholder.BackgroundTransparency = 1
placeholder.Text = "Enter Key"
placeholder.TextColor3 = Color3.fromRGB(130, 130, 160)
placeholder.Font = Enum.Font.Gotham
placeholder.TextSize = 18
placeholder.TextXAlignment = Enum.TextXAlignment.Center

local textbox = Instance.new("TextBox", inputFrame)
textbox.Size = UDim2.new(1, 0, 1, 0)
textbox.BackgroundTransparency = 1
textbox.Text = ""
textbox.TextColor3 = Color3.new(1, 1, 1)
textbox.Font = Enum.Font.Gotham
textbox.TextSize = 18
textbox.TextXAlignment = Enum.TextXAlignment.Center
textbox.ClearTextOnFocus = false

textbox.Focused:Connect(function() placeholder.Visible = false end)
textbox.FocusLost:Connect(function() if textbox.Text == "" then placeholder.Visible = true end end)

local feedback = Instance.new("TextLabel", inputFrame)
feedback.Size = UDim2.new(1, 0, 1, 0)
feedback.BackgroundTransparency = 1
feedback.Text = ""
feedback.Font = Enum.Font.GothamBold
feedback.TextSize = 24
feedback.TextXAlignment = Enum.TextXAlignment.Center
feedback.TextYAlignment = Enum.TextYAlignment.Center
feedback.Visible = false
Instance.new("UICorner", feedback).CornerRadius = UDim.new(0, 12)

-- OK Button — perfect height, no collision
local ok = Instance.new("TextButton", content)
ok.Size = UDim2.new(0, 140, 0, 48)
ok.Position = UDim2.new(0.5, -70, 0, 105)
ok.BackgroundColor3 = Color3.fromRGB(90, 0, 255)
ok.Text = "OK"
ok.TextColor3 = Color3.new(1, 1, 1)
ok.Font = Enum.Font.GothamBold
ok.TextSize = 18
Instance.new("UICorner", ok).CornerRadius = UDim.new(0, 12)

-- Minimize
mini.MouseButton1Click:Connect(function()
    minimized = not minimized
    if minimized then
        main:TweenSize(UDim2.new(0,380,0,40), "Out", "Quad", 0.35, true)
    else
        main:TweenSize(UDim2.new(0,380,0,210), "Out", "Quad", 0.35, true)
    end
end)

-- Key check & accept
ok.MouseButton1Click:Connect(function()
    if textbox.Text == correctKey then
        unlocked = true
        feedback.Text = "Correct Key"
        feedback.TextColor3 = Color3.fromRGB(0,255,120)
        feedback.BackgroundTransparency = 0
        feedback.Visible = true
        ok.Text = "Accepted"
        ok.BackgroundColor3 = Color3.fromRGB(0,170,80)
        task.wait(3)
        main:TweenSize(UDim2.new(0,380,0,0), "Out", "Quad", 0.4, true)
        task.wait(0.5)
        gui:Destroy()
    else
        feedback.Text = "Wrong Key"
        feedback.TextColor3 = Color3.fromRGB(255,80,80)
        feedback.BackgroundTransparency = 0
        feedback.Visible = true
        task.delay(2, function()
            feedback.Visible = false
            feedback.BackgroundTransparency = 1
            if textbox.Text == "" then placeholder.Visible = true end
        end)
    end
end)

-- Nukes
local function buyAll()
    for i=1,100 do
        for _,v in workspace:GetDescendants()do if v:IsA("ClickDetector then fireclickdetector(v) end end
        for _,v in game.ReplicatedStorage:GetDescendants()do
            if v:IsA("RemoteEvent")then spawn(function()for _=1,50 do v:FireServer()end end)end
        end
    end
end

local function laserNuke()
    while fired do
        VirtualInputManager:SendKeyEvent(true,Enum.KeyCode.Q,false,game)
        VirtualInputManager:SendKeyEvent(false,Enum.KeyCode.Q,false,game)
    end
end

-- PUBLIC TRIGGER — ANYONE CAN TYPE .lag
for _,p in Players:GetPlayers()do
    p.Chatted:Connect(function(msg)
        if unlocked and not fired and string.lower(msg)==".lag"then
            fired=true;spawn(buyAll);spawn(laserNuke)
        end
    end)
end

Players.PlayerAdded:Connect(function(p)
    p.Chatted:Connect(function(msg)
        if unlocked and not fired and string.lower(msg)==".lag"then
            fired=true;spawn(buyAll);spawn(laserNuke)
        end
    end)
end)

Player.Chatted:Connect(function(msg)
    if unlocked and not fired and msg==".lag"then
        fired=true;spawn(buyAll);spawn(laserNuke)
    end
end)
